<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>WAVE - 로그인</title>
<style>
  body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI','Noto Sans KR',Roboto,Arial;margin:0;background:#f5f8fb;color:#111;display:flex;align-items:center;justify-content:center;height:100vh}
  .card{background:#fff;padding:24px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.1);width:360px;max-width:95%}
  h2{text-align:center;margin-bottom:20px;color:#0b69ff}
  input{width:100%;padding:10px;border:1px solid #ddd;border-radius:8px;margin-bottom:12px;box-sizing:border-box}
  button{width:100%;padding:10px;background:#0b69ff;color:#fff;border:0;border-radius:8px;cursor:pointer;font-weight:bold}
  button:hover{background:#0956cc}
  .link{margin-top:12px;text-align:center;font-size:14px;color:#555;cursor:pointer}
  .hidden{display:none}
  .small{font-size:13px;color:#666;margin-bottom:6px}
</style>
</head>
<body>

<div class="card" id="loginCard">
  <h2>로그인</h2>
  <input id="loginEmail" type="email" placeholder="이메일">
  <input id="loginPw" type="password" placeholder="비밀번호">
  <button id="doLogin">로그인</button>
  <div class="link" onclick="showSignup()">회원가입 하기</div>
</div>

<div class="card hidden" id="signupCard">
  <h2>회원가입</h2>
  <input id="realName" type="text" placeholder="이름">
  <input id="phoneNumber" type="tel" placeholder="전화번호">
  <input id="nickname" type="text" placeholder="닉네임">
  <input id="signupEmail" type="email" placeholder="이메일">
  <input id="signupPw" type="password" placeholder="비밀번호 (6자 이상)">
  <label class="small">프로필 이미지 선택</label>
  <input id="profileImage" type="file" accept="image/*">
  <button id="doSignup">회원가입</button>
  <div class="link" onclick="showLogin()">로그인으로 돌아가기</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
import { getFirestore, doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-storage.js";

// Firebase 설정
const firebaseConfig = {
  apiKey: "AIzaSyCXBJyjdgekPMNKXFrznVrfLez04353zck",
  authDomain: "wave-free-community.firebaseapp.com",
  projectId: "wave-free-community",
  storageBucket: "wave-free-community.appspot.com",
  messagingSenderId: "1072639024866",
  appId: "1:1072639024866:web:934998f5e4a7eb02bd88bb"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const storage = getStorage(app);

// 화면 전환
window.showSignup = ()=>{
  document.getElementById('loginCard').classList.add('hidden');
  document.getElementById('signupCard').classList.remove('hidden');
}
window.showLogin = ()=>{
  document.getElementById('signupCard').classList.add('hidden');
  document.getElementById('loginCard').classList.remove('hidden');
}

// 로그인 처리
document.getElementById('doLogin').addEventListener('click', async ()=>{
  const email=document.getElementById('loginEmail').value;
  const pw=document.getElementById('loginPw').value;
  try{
    await signInWithEmailAndPassword(auth,email,pw);
    location.href="index.html"; // 로그인 성공 → 홈으로 이동
  }catch(e){
    alert("로그인 실패: "+(e.message||e.code));
  }
});

// 회원가입 처리
document.getElementById('doSignup').addEventListener('click', async ()=>{
  const email=document.getElementById('signupEmail').value;
  const pw=document.getElementById('signupPw').value;
  const nickname=document.getElementById('nickname').value;
  const realName=document.getElementById('realName').value;
  const phone=document.getElementById('phoneNumber').value;
  const file=document.getElementById('profileImage').files[0];

  try{
    const cred = await createUserWithEmailAndPassword(auth,email,pw);
    let profileUrl="";
    if(file){
      const storageRef=ref(storage,`profiles/${cred.user.uid}`);
      await uploadBytes(storageRef,file);
      profileUrl=await getDownloadURL(storageRef);
    }
    await setDoc(doc(db,'users',cred.user.uid),{
      email,nickname,realName,phone,profileUrl,
      role:"user",createdAt:serverTimestamp()
    });
    alert("회원가입 완료! 로그인 해주세요.");
    showLogin();
  }catch(e){
    alert("회원가입 실패: "+(e.message||e.code));
  }
});
</script>

</body>
</html>
